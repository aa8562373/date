{"name":"Date","tagline":"日期插件","body":"\r\n\r\ndefine(function(require) {\r\n\t//日期\r\n\tvar DatePicker = function(opts) {\r\n\t\tvar me = this,\r\n\t\t\toptions = {\r\n\t\t\t\tminDate: '',\r\n\t\t\t\tmaxDate: '',\r\n\t\t\t\t$wrap: $('.date-wrap'),\r\n\t\t\t\ttoday: '',\r\n\t\t\t\tmonthOffset: '0,6',\r\n\t\t\t\tonRender: function(date) {\r\n\t\t\t\t\t\r\n\t\t\t\t},\r\n\t\t\t\tonChoose: function(date) {\r\n\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\r\n\t\tthis.elementMap = {};\r\n\t\t\r\n\t\tthis.opts = $.extend({}, options, opts);\r\n\t\tthis.init();\r\n\t\t\r\n\t\treturn {\r\n\t\t\tgetElement: function(date) {\r\n\t\t\t\treturn me.elementMap[date];\r\n\t\t\t},\r\n\t\t\tonChoose: function() {\r\n\t\t\t\t\r\n\t\t\t},\r\n\t\t\tchoose: function(date) {\r\n\t\t\t\t\r\n\t\t\t},\r\n\t\t\tset: function(column, date) {\r\n\t\t\t\tcolumn = $.inArray(column, ['minDate', 'maxDate']) === -1 ? 'minDate': column; \r\n\t\t\t\tme.opts[column] = date;\r\n\t\t\t\tme.toggleDisabled();\r\n\t\t\t}\r\n\t\t};\r\n\t},\r\n\t\r\n\t_titleTemplate = '<%=year%><span class=\"year\">年</span><%=month%><span class=\"year\">月</span>',\r\n\t\r\n\t_monthTemplate = ''\r\n\t\t+'<div class=\"dateWrap\">'\r\n\t\t+\t'<h2><%=title%></h2>'\r\n\t\t+\t'<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">'\r\n\t\t+\t\t'<thead>'\r\n\t\t+\t\t'<tr>'\r\n\t\t+\t\t\t'<td class=\"td_xq\">SUN</td>'\r\n\t\t+\t\t\t'<td class=\"td_xq\">MON</td>'\r\n\t\t+\t\t\t'<td class=\"td_xq\">TUE</td>'\r\n\t\t+\t\t\t'<td class=\"td_xq\">WED</td>'\r\n\t\t+\t\t\t'<td class=\"td_xq\">THU</td>'\r\n\t\t+\t\t\t'<td class=\"td_xq\">FRI</td>'\r\n\t\t+\t\t\t'<td class=\"td_xq\">STA</td>'\r\n\t\t+\t\t'</tr>'\r\n\t\t+\t\t'</thead>'\r\n\t\t+\t\t'<tbody class=\"tbody\"></tbody>'\r\n\t\t+\t'</table>'\r\n\t\t+'</div>',\r\n\t\t\r\n\t_itemTemplate = '<td data-date=\"<%=date%>\"><span><%=day%></span></td>';\r\n\t\r\n\tDatePicker.prototype = {\r\n\t\t\r\n\t\tconstructor: DatePicker,\r\n\t\t\t\r\n\t\tinit: function() {\r\n\t\t\tthis.render();\r\n\t\t\tthis.event();\r\n\t\t},\r\n\t\t\r\n\t\trender: function() {\r\n\t\t\tvar me = this,\r\n\t\t\t\t$wrap = this.opts.$wrap,\r\n\t\t\t\ttoday = this.opts.today ? this.parseDate(this.opts.today) : new Date(),\r\n\t\t\t\tmonthMap = this.getMonthMap(today);\r\n\t\t\t\r\n\t\t\tthis.opts.today = this.getDate(today);\r\n\t\t\t\t\r\n\t\t\t$.each(monthMap, function(k, v) {\r\n\t\t\t\tme.renderItem(v[0], v[1], $wrap);\r\n\t\t\t});\r\n\t\t},\r\n\t\t\r\n\t\tevent: function() {\r\n\t\t\tvar me = this, $wrap = this.opts.$wrap;\r\n\t\t\t$wrap.on('click', 'td', function() {\r\n\t\t\t\tvar $this = $(this), date;\r\n\t\t\t\tif ($this.hasClass('disabled')) return;\r\n\t\t\t\tdate = $this.data('date');\r\n\t\t\t\t\r\n\t\t\t\tif (date) {\r\n\t\t\t\t\tme.opts.onChoose && me.opts.onChoose(date, $this);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\t\r\n\t\trenderItem: function(y, m, $wrap) {\r\n\t\t\tvar $month = $(this.template(_monthTemplate, {title: this.template(_titleTemplate, {year: y, month: this.fillZero(m)})})).appendTo($wrap),\r\n\t\t\t\t$item = $month.find('.tbody'),\r\n\t\t\t\tstart = new Date(y, m - 1, 1).getDay(),\r\n\t\t\t\tlength = new Date(y, m, 0).getDate(),\r\n\t\t\t\tcount = start + length,\r\n\t\t\t\toffset = (count % 7 === 0) ? count/7 : Math.floor((count+7) / 7),\r\n\t\t\t\t$tr, date, day, $td;\r\n\t\t\t\r\n\t\t\tfor (var i = 0; i < offset; i++) {\r\n\t\t\t\t$tr = $('<tr></tr>').appendTo($item);\r\n\t\t\t\t\r\n\t\t\t\tfor (var j = 0; j < 7; j++) {\r\n\t\t\t\t\tday = i * 7 + j - start + 1;\r\n\t\t\t\t\tif (day > 0 && day <= length) {\r\n\t\t\t\t\t\tdate = this.fillDate(y, m, day);\r\n\t\t\t\t\t\t$td = $(this.template(_itemTemplate, {date: date, day: day})).appendTo($tr);\r\n\t\t\t\t\t\tthis.onRender(date, $td[0]);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$tr.append('<td> </td>');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\tonRender: function(date, elem) {\r\n\t\t\tvar minDate = this.opts.minDate, maxDate = this.opts.maxDate, today = this.opts.today;\r\n\t\t\tthis.elementMap[date] = elem;\r\n\t\t\t\r\n\t\t\t(minDate && (date < minDate)) && $(elem).addClass('disabled');\r\n\t\t\t(maxDate && (date > maxDate)) && $(elem).addClass('disabled');\r\n\t\t\t(date == today) && $(elem).addClass('today');\r\n\t\t\t\r\n\t\t\tthis.opts.onRender && this.opts.onRender.apply(this, arguments);\r\n\t\t},\r\n\t\t\r\n\t\tgetMonthMap: function(today) {\r\n\t\t\tvar year = today.getFullYear(), month = today.getMonth(), \r\n\t\t\t\toffsets = this.opts.monthOffset.split(','),\r\n\t\t\t\tmin = parseInt(offsets[0]), max = parseInt(offsets[1]),\r\n\t\t\t\tmap = [], m, y;\r\n\t\t\t\r\n\t\t\tfor (var i = min; i <= max; i++) {\r\n\t\t\t\tm = month+i;\r\n\t\t\t\ty = year + Math.floor(m / 12);\r\n\t\t\t\t\r\n\t\t\t\tm = (m % 12 + 12) % 12;\r\n\t\t\t\tmap.push([y, m+1]);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn map;\r\n\t\t},\r\n\t\t\r\n\t\ttoggleDisabled: function() {\r\n\t\t\tvar minDate = this.opts.minDate, maxDate = this.opts.maxDate;\r\n\t\t\t\r\n\t\t\t$.each(this.elementMap, function() {\r\n\t\t\t\tvar $this = $(this), date = $this.data('date');\r\n\t\t\t\t$this.toggleClass('disabled', (minDate ? (date < minDate) : false) || (maxDate ? (date > maxDate) : false));\r\n\t\t\t})\r\n\t\t},\r\n\t\t\r\n\t\tparseDate: function(date) {\r\n\t\t\tvar matched;\r\n\t\t\tif (matched = date.match(/(\\d{4})-(\\d{2})-(\\d{2})/)) {\r\n\t\t\t\treturn new Date(matched[1], matched[2] - 1, matched[3]);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\tfillDate: function(y, m, d) {\r\n\t\t\treturn y + '-' + this.fillZero(m) + '-' + this.fillZero(d);\r\n\t\t},\r\n\t\t\r\n\t\tfillZero: function(i) {\r\n\t\t\treturn i < 10 ? ('0' + i) : i;\r\n\t\t},\r\n\t\t\r\n\t\tgetDate: function(dateObj) {\r\n\t\t\treturn this.fillDate(dateObj.getFullYear(), dateObj.getMonth()+1, dateObj.getDate());\r\n\t\t},\r\n\t\t\r\n\t\ttemplate: function(temp, data) {\r\n        \treturn temp.replace(/\\<\\%\\=(\\w+)\\%\\>/g, function(word, key) {return data[key] || '';});\r\n        }\r\n\t\t\t\r\n\t};\r\n\t\r\n\treturn DatePicker;\r\n});\r\n\r\n\r\n\r\n\r\n\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}